---
title: Seed - ç§å­
group:
  title: å·¥å…·
  path: /utils
  order: 5000
---

# Seed ç§å­

æä¾›æƒé™ã€çŠ¶æ€ç®¡ç†ç­‰æ ¸å¿ƒä¸”åŸºç¡€çš„åŠŸèƒ½

## çŠ¶æ€ç®¡ç†

**åº”ç”¨çŠ¶æ€**

ç±»ä¼¼`redux`, çŠ¶æ€ç”±ä¸€ä¸ªçŠ¶æ€å¯¹è±¡è¡¨ç¤ºï¼Œä½†æ˜¯ seed çš„ä½¿ç”¨æ›´åŠ è½»æ¾å’Œç®€å•.

ğŸ’¡ ä½ ä¹Ÿå¯ä»¥é€šè¿‡`create()`æ¥åˆ›å»ºå¤šä¸ª seed å®ä¾‹ï¼Œè¿™å¯ä»¥å®ç°æŸäº›çŠ¶æ€ç®¡ç†åº“ä¸­çš„`model`æ¦‚å¿µ

**è·å–çŠ¶æ€**

- æœ‰ä¸‰ç§æ–¹å¼è·å–çŠ¶æ€, åˆ†åˆ«æ˜¯ `seedå®ä¾‹` ä¸‹çš„ `getState()`ã€`useState()`ã€`<State />` ä¸‰ä¸ª api
- `useDeps`å’Œ`Deps`çš„ä¼˜åŠ¿æ˜¯ä¼šå“åº” deps çš„å˜æ›´è€Œè¿›è¡Œæ›´æ–°ï¼Œè€Œ`getState()`ç”¨äºç®€å•çš„è·å–çŠ¶æ€

<code src="./get-deps-demo.tsx" />

## æƒé™æ§åˆ¶

### åŸºæœ¬è¯´æ˜

åˆ›å»º seed å®ä¾‹å¹¶é€šè¿‡é€šè¿‡ Auth ç»„ä»¶æ¥å¯¹æŒ‡å®šèŠ‚ç‚¹é™„åŠ æƒé™

<code src="./base-demo.tsx" />

### åé¦ˆæ–¹å¼

æ— æƒé™æ—¶æœ‰ä¸‰ç§å¯é€‰çš„åé¦ˆæ–¹å¼ï¼šå ä½èŠ‚ç‚¹ã€æ°”æ³¡æ¡†æç¤ºã€éšè—

<code src="./feedback-type-demo.tsx" />

### æƒé™ç»„ä»¶

ä¸ºç°æœ‰ç»„ä»¶é™„åŠ æƒé™æ§åˆ¶ï¼Œç”Ÿæˆçš„æƒé™ç»„ä»¶ä¼šç›´æ¥é™„å¸¦æƒé™éªŒè¯ï¼Œå¯ç”¨äºè·¯ç”±ç»„ä»¶ç­‰çš„æƒé™éªŒè¯

<code src="./with-auth-demo.tsx" />

### useAuth

hooks å¼çš„éªŒè¯ï¼Œæ¥å—éªŒè¯å‚æ•°ï¼Œè¿”å›éªŒè¯ç»“æœ

<code src="./use-auth-demo.tsx" />

### æˆ–

ç±»ä¼¼ç¼–ç¨‹è¯­è¨€ä¸­çš„ `||`ï¼Œå¦‚æœéœ€è¦åœ¨ä¸¤ä¸ªæƒé™ä¸­ä»»æ„ä¸€ä¸ªé€šè¿‡å°±é€šè¿‡éªŒè¯ï¼Œå¯ä»¥å°†æƒé™ key è®¾ç½®ä¸ºäºŒç»´æ•°ç»„`['key', ['key2', 'key3']]`Â·

ğŸ’¡ ä¸å¸¸è§„éªŒè¯å™¨ä¸åŒï¼Œä¸²è”çš„ `æˆ–éªŒè¯å™¨` ä¸ä¼šåœ¨å‰é¢çš„éªŒè¯å™¨æ‰§è¡Œå¤±è´¥åé˜»æ­¢åé¢çš„åŒçº§éªŒè¯å™¨æ‰§è¡Œ

<code src="./or-demo.tsx" />

### é¢å¤–å‚æ•°

æŸäº›éªŒè¯å™¨ä¼šéœ€è¦æ¥å—å½“å‰çš„æŸäº›è¿è¡Œæ—¶å‚æ•°ä½œä¸ºéªŒè¯å‚ç…§ï¼ˆæ¯”å¦‚éªŒè¯æ˜¯å¦ä¸ºæœ¬äººï¼Œä¼šéœ€è¦ä¼ å…¥å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ç»™éªŒè¯å™¨ï¼‰ï¼Œå¯ä»¥é€šè¿‡ extra ä¼ é€’

<code src="./extra-demo.tsx" />

### å®šåˆ¶åé¦ˆèŠ‚ç‚¹

<code src="./custom-demo.tsx" />

### å±€éƒ¨éªŒè¯å™¨

åªä½œç”¨äºå½“å‰æŒ‚è½½ç»„ä»¶çš„éªŒè¯å™¨

<code src="./scope-demo.tsx" />

## åº•å±‚ api

æœ€åŸºæœ¬çš„åº•å±‚é€»è¾‘åœ¨å¤–éƒ¨åŒ…ä¸­ç»´æŠ¤ï¼Œ[@m78/seed](https://github.com/m78-core/seed)ï¼Œä½ å¯ä»¥åœ¨å…¶æ–‡æ¡£æŸ¥çœ‹`setState()`, `getState()`, `subscribe()`, `auth()`ï¼Œ ä¸­é—´ä»¶ç³»ç»Ÿç­‰åº•å±‚ api çš„ç”¨æ³•

## ä¸­é—´ä»¶

ä¸­é—´ä»¶ç”¨äºå¢å¼º apiï¼ŒåŠ¨æ€æ›´æ”¹åˆå§‹é…ç½®ï¼Œå†…ç½®äº†ä¸¤ä¸ªä¸­é—´ä»¶:

- cacheMiddleware
- devtool

```ts
import create, { cacheMiddleware, devtoolMiddleware } from 'm78/seed';

create({
  middleware: [
    // å¯ç”¨stateç¼“å­˜åŠŸèƒ½ï¼Œé”€æ¯æ—¶å°†çŠ¶æ€å­˜å‚¨åˆ°sessionæˆ–storageä¸­å¹¶åœ¨ä¸‹æ¬¡è¿›å…¥æ—¶è¿˜åŸ
    cacheMiddleware('my_auth_deps', 86400000),
    // å¼€å¯å¯¹redux-devtoolçš„æ”¯æŒï¼Œå¯ä»¥é€šè¿‡è¯¥æµè§ˆå™¨æ’ä»¶æ¥æŸ¥çœ‹å½“å‰çŠ¶æ€
    devtool,
  ],
});
```

å¦‚æœè¦è‡ªå·±ç¼–å†™ä¸­é—´ä»¶, è¯·æŸ¥çœ‹[@m78/seed](https://github.com/m78-core/seed#middleware)

## API

ä»¥ä¸‹æ‰€æœ‰ api éƒ½åŒ…å«åœ¨ create()åˆ›å»ºçš„ seed å®ä¾‹å¯¹è±¡ä¸­

å¤§éƒ¨åˆ† api ç­¾åéƒ½æ˜¯ä¼ªä»£ç ï¼Œè¯¦ç»†è¯´æ˜è¯·ç›´æ¥åœ¨å¼€å‘æ—¶ç‚¹å‡»å¯¹åº”å‡½æ•°/ç»„ä»¶æŸ¥çœ‹ç±»å‹å£°æ˜æ–‡ä»¶

### **`<Auth />`**

ä¸ºåŒ…è£¹çš„å†…éƒ¨èŠ‚ç‚¹æ·»åŠ æƒé™éªŒè¯

```ts | pure
interface AuthProps<D, V> {
  /**
   * æƒé™éªŒè¯é€šè¿‡åæ˜¾ç¤ºçš„å†…å®¹
   * * å½“typeä¸ºtooltipæ—¶ï¼Œå¿…é¡»ä¼ å…¥å•ä¸ªå­å…ƒç´ ï¼Œå¹¶ä¸”ä¿è¯å…¶èƒ½æ­£å¸¸æ¥æ”¶äº‹ä»¶
   * */
  children: React.ReactElement | (() => React.ReactElement);
  /**
   * å¾…éªŒè¯çš„æƒé™keyç»„æˆçš„æ•°ç»„
   * * åªè¦æœ‰ä¸€ä¸ªæƒé™æœªéªŒè¯é€šè¿‡ï¼Œåç»­éªŒè¯å°±ä¼šè¢«ä¸­æ–­ï¼Œæ‰€ä»¥keyçš„ä¼ å…¥é¡ºåºæœ€å¥½æŒ‰ä¼˜å…ˆçº§ä»å·¦åˆ°å³ï¼Œå¦‚: ['login', 'isVip']
   * * å¯ä»¥é€šè¿‡äºŒç»´æ•°ç»„æ¥ç»„åˆä¸¤ä¸ªæ¡ä»¶['key1', ['key2', 'key3']], ç»„åˆçš„æ¡ä»¶è¡¨ç¤ºé€»è¾‘ `or` */
  keys: AuthKeys<V>;
  /** 'feedback' | åé¦ˆæ–¹å¼ï¼Œå ä½èŠ‚ç‚¹ã€éšè—ã€æ°”æ³¡æç¤ºæ¡†, å½“typeä¸ºpopperæ—¶ï¼Œä¼šè‡ªåŠ¨æ‹¦æˆªå­å…ƒç´ çš„onClickäº‹ä»¶, åŒæ—¶ï¼Œä¹Ÿéœ€è¦ç¡®ä¿å­èŠ‚ç‚¹ç¬¦åˆ<Popper />ç»„ä»¶çš„å­èŠ‚ç‚¹è§„åˆ™ */
  type?: 'feedback' | 'hidden' | 'popper' | AuthTypeEnum;
  /** ä¼ é€’ç»™éªŒè¯å™¨çš„é¢å¤–å‚æ•° */
  extra?: any;
  /**
   * å®šåˆ¶æ— æƒé™æ—¶çš„åé¦ˆæ ·å¼
   * @param rejectMeta - æœªé€šè¿‡çš„æƒé™çš„å…·ä½“ä¿¡æ¯
   * @param props - ç»„ä»¶æ¥æ”¶çš„åŸå§‹props
   * @return - è¿”å›ç”¨äºæ˜¾ç¤ºçš„åé¦ˆèŠ‚ç‚¹
   * */
  feedback?: (rejectMeta: ValidMeta, props: AuthProps<D, V>) => React.ReactNode;
  /** æ˜¯å¦ç¦ç”¨ï¼Œç¦ç”¨æ—¶ç›´æ¥æ˜¾ç¤ºå­èŠ‚ç‚¹ */
  disabled?: boolean;
  /** å±€éƒ¨éªŒè¯å™¨ */
  validators?: Validators<D>;
  /** è‡ªå®šä¹‰æ˜¾ç¤ºçš„403 icon */
  icon?: React.ReactNode;
}
```

### **`withAuth()`**

åˆ›å»ºä¸€ä¸ªæƒé™ç»„ä»¶

`conf`å‚æ•°æ”¯æŒ`<Auth />`é™¤`children`å¤–çš„æ‰€æœ‰`props`

```ts
(conf: Omit<AuthProps<D, V>, 'children'>) => (Component: React.ComponentType<P>) => React.FC<P>
```

### **`useState()`**

è·å–`state`

```ts
interface UseState<D> {
  <ScopeDep = any>(
    /**
     * ä»depsä¸­é€‰æ‹©éƒ¨åˆ†depså¹¶è¿”å›ï¼Œå¦‚æœçœç•¥ï¼Œä¼šè¿”å›æ•´ä¸ªdepså¯¹è±¡
     * - å¦‚æœæœªé€šè¿‡selectoré€‰å–depsï¼Œhookä¼šåœ¨æ¯ä¸€æ¬¡depså˜æ›´æ—¶æ›´æ–°ï¼Œé€‰å–å±€éƒ¨depsæ—¶åªåœ¨é€‰å–éƒ¨åˆ†å˜æ›´æ—¶æ›´æ–°
     * - å°½é‡åªé€šè¿‡selectorè¿”å›å¿…è¦å€¼ï¼Œä»¥å‡å°‘hookæ‰€åœ¨ç»„ä»¶çš„æ›´æ–°æ¬¡æ•°
     * - å¦‚æœé€‰å–çš„ä¾èµ–å€¼æ˜¯å¯¹è±¡ç­‰å¼•ç”¨ç±»å‹å€¼ï¼Œç›´æ¥`deps => deps.xxx`è¿”å›å³å¯ï¼Œå¦‚æœç±»ä¼¼`deps => ({ ...deps.xxx })`è¿™æ ·æ›´æ–°å¼•ç”¨åœ°å€ï¼Œä¼šé€ æˆä¸å¿…è¦çš„æ›´æ–°
     * */
    selector?: (deps: D) => ScopeDep,
    /**
     * æ¯æ¬¡depså˜æ›´æ—¶ä¼šç®€å•é€šè¿‡`===`æ¯”å‰åçš„å€¼ï¼Œå¦‚æœç›¸ç­‰åˆ™ä¸ä¼šæ›´æ–°hookï¼Œä½ å¯ä»¥é€šè¿‡æ­¤å‡½æ•°æ¥å¢å¼ºå¯¹æ¯”è¡Œä¸ºï¼Œå¦‚ä½¿ç”¨_.isEqualè¿›è¡Œæ·±å¯¹æ¯”
     * - å¦‚æœåœ¨selectorä¸­æ­£ç¡®ä¿ç•™äº†å¼•ç”¨ï¼Œå¾ˆå°‘ä¼šç›´æ¥ç”¨åˆ°æ­¤å‚æ•°
     * - å³ä½¿ä¼ å…¥äº†è‡ªå®šä¹‰å¯¹æ¯”å‡½æ•°ï¼Œä¾ç„¶ä¼šå…ˆæ‰§è¡Œ `===` å¯¹æ¯”
     * */
    equalFn?: (next: ScopeDep, prev?: ScopeDep) => boolean,
  ): ScopeDep;
}
```

### **`<State />`**

é€šè¿‡`render children`æ¥è·Ÿè¸ª`state`å¹¶æ¸²æŸ“è¿”å›çš„èŠ‚ç‚¹

```ts
interface State<D> {
  (props: { children: (deps: D) => React.ReactNode }): React.ReactElement | null;
}
```

### **`useAuth()`**

ä»¥ hook çš„å½¢å¼ä½¿ç”¨`seed.auth()`, ä¼šè‡ªåŠ¨è·Ÿè¸ªä¾èµ–å€¼å’Œ key å˜æ›´

```ts
interface AuthConfig<D> {
  /** ä¼ é€’ç»™éªŒè¯å™¨çš„é¢å¤–å‚æ•° */
  extra?: any;
  /** å±€éƒ¨éªŒè¯å™¨ */
  validators?: Validators<D>;
}

interface UseAuth<D, V> {
  (
    keys: AuthKeys<V>,
    config?: {
      /** æ˜¯å¦å¯ç”¨ */
      disabled?: boolean;
    } & AuthConfig<D>,
  ): /** æ‰€æœ‰æœªé€šè¿‡éªŒè¯å™¨è¿”å›çš„ValidMetaï¼Œå¦‚æœä¸ºnullåˆ™è¡¨ç¤ºéªŒè¯é€šè¿‡ */
  ValidMeta[] | null;
}
```

### **`setState()`**

è®¾ç½®`state`å€¼

```ts
SetState<S & {
  [key: string]: any;
}>
```

### **`getState()`**

è·å–å½“å‰çš„ `state`

### **`subscribe()`**

è®¢é˜… dependency å˜æ›´, è¿”å›çš„å‡½æ•°ç”¨äºå–æ¶ˆæ”¹è®¢é˜…

```ts
type Listener<S extends object = AnyObject> = (changes: Partial<S>) => void;

type Subscribe = (listener: Listener) => () => void;
```

### **`auth()`**

```ts
{
  /**
   * @param authKeys - æ‰€å±æƒé™, å¦‚æœæ•°ç»„é¡¹ä¸ºæ•°ç»„åˆ™è¡¨ç¤ºé€»è¾‘ `or`
   * @return [pass, rejects] - éªŒè¯ç»“æŸçš„å›è°ƒ
   * å›è°ƒæ¥æ”¶:
   *   * pass æ˜¯å¦é€šè¿‡äº†æ‰€æœ‰æŒ‡å®šçš„éªŒè¯
   *   * rejects æœªé€šè¿‡çš„éªŒè¯å™¨è¿”å›çš„ValidMetaåˆ—è¡¨
   * */
  auth(authKeys: AuthKeys<V>): ValidMeta[] | null;
  /**
   * @param authKeys - æ‰€å±æƒé™, å¦‚æœæ•°ç»„é¡¹ä¸ºæ•°ç»„åˆ™è¡¨ç¤ºé€»è¾‘ `or`
   * @param config - é…ç½®
   * @param config.extra - ä¼ é€’ç»™éªŒè¯å™¨çš„é¢å¤–å‚æ•°
   * @param config.validators - å±€éƒ¨éªŒè¯å™¨
   * @return [pass, rejects] - éªŒè¯ç»“æŸçš„å›è°ƒ
   * å›è°ƒæ¥æ”¶:
   *   * pass æ˜¯å¦é€šè¿‡äº†æ‰€æœ‰æŒ‡å®šçš„éªŒè¯
   *   * rejects æœªé€šè¿‡çš„éªŒè¯å™¨è¿”å›çš„ValidMetaåˆ—è¡¨
   * */
  auth(authKeys: AuthKeys<V>, config: AuthConfig<S>): ValidMeta[] | null;
}
```
