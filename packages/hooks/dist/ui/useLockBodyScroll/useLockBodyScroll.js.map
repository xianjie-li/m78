{"version":3,"sources":["/Users/lixianjie/project/play/mono-test/packages/hooks/src/ui/useLockBodyScroll/useLockBodyScroll.ts"],"sourcesContent":["import { useEffect, useMemo, useRef } from \"react\";\nimport { createRandString, hasScroll } from \"@m78/utils\";\n\nlet scrollPosition = 0; // 保存锁定时的滚动位置\n\nconst list: any = [];\n\n/**\n * 锁定滚动条并对滚动条宽度进行修正\n * @param locked - 根据传入值对滚动条进行锁定/解锁\n * */\nexport const useLockBodyScroll = (locked: boolean) => {\n  const id = useMemo(() => createRandString(), []);\n\n  const instance = useRef({\n    bodyEl: null! as HTMLElement,\n  });\n\n  useEffect(() => {\n    instance.current.bodyEl = document.body;\n  }, []);\n\n  // 存取list\n  useEffect(() => {\n    if (locked) {\n      list.push(id);\n      if (list.length === 1) lock();\n    }\n    return () => {\n      if (!locked) return;\n      const ind = list.indexOf(id);\n      if (ind !== -1) list.splice(ind, 1);\n      if (!list.length) unlock();\n    };\n  }, [locked]);\n\n  function lock() {\n    const bodyEl = instance.current.bodyEl;\n\n    // 不同浏览器会使用不同的根滚动，这里需要进行一下兼容\n    const bodyScrollInfo = hasScroll(bodyEl);\n    const docScrollInfo = hasScroll(document.documentElement);\n\n    const hasX = bodyScrollInfo.x || docScrollInfo.x;\n    const hasY = bodyScrollInfo.y || docScrollInfo.y;\n\n    bodyEl.setAttribute(\"data-locked\", \"1\");\n    scrollPosition = window.pageYOffset;\n    bodyEl.style.width = \"100%\";\n    bodyEl.style.overflowY = hasY ? \"scroll\" : \"hidden\";\n    bodyEl.style.overflowX = hasX ? \"scroll\" : \"hidden\";\n    bodyEl.style.position = \"fixed\";\n    bodyEl.style.top = `-${scrollPosition}px`;\n  }\n\n  function unlock() {\n    const bodyEl = instance.current.bodyEl;\n\n    bodyEl.setAttribute(\"data-locked\", \"0\");\n    bodyEl.style.width = \"\";\n    bodyEl.style.overflowY = \"\";\n    bodyEl.style.overflowX = \"\";\n    bodyEl.style.position = \"\";\n    bodyEl.style.top = \"\";\n    window.scrollTo(0, scrollPosition);\n  }\n};\n"],"names":["useEffect","useMemo","useRef","createRandString","hasScroll","scrollPosition","list","useLockBodyScroll","locked","lock","bodyEl","instance","current","bodyScrollInfo","docScrollInfo","document","documentElement","hasX","x","hasY","y","setAttribute","window","pageYOffset","style","width","overflowY","overflowX","position","top","unlock","scrollTo","id","body","push","length","ind","indexOf","splice"],"mappings":"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"}