{"version":3,"sources":["/Users/lixianjie/project/play/mono-test/packages/hooks/src/effect/useFn/useFn.ts"],"sourcesContent":["import { useRef, useMemo } from \"react\";\nimport { AnyFunction } from \"@m78/utils\";\n\n/**\n * 用于代替`useCallback`，使回调函数的引用地址永久不变, 从而减少消费组件不必要的更新。\n * 该hook的另一个用例是解决闭包导致的回调内外状态不一致问题，并且它不需要传递`deps`参数\n * @param fn - 需要`memo`化的函数\n * @param wrapper - 接收fn并返回，可以藉此对函数实现节流等增强操作, 只在初始化和deps改变时调用\n * @param deps - 依赖数组，如果传入，其中任意值改变都会重载缓存的fn，可以用来更新wrapper包装的函数\n * @returns - 经过memo化的函数\n */\nexport function useFn<T extends AnyFunction>(\n  fn: T,\n  wrapper?: (fn: T) => T,\n  deps = [] as any[]\n) {\n  const fnRef = useRef<T>();\n  const memoFnRef = useRef<T>(null!);\n\n  // 更新缓存fn\n  useMemo(() => {\n    if (!memoFnRef.current) return;\n    wrapFn();\n  }, deps);\n\n  // 初始化缓存fn\n  if (!memoFnRef.current) wrapFn();\n\n  /** 兼容devtool，直接写fnRef.current会阻断更新 */\n  (useMemo as any)(() => {\n    fnRef.current = fn;\n  });\n\n  function wrapFn() {\n    function memoFn(this: any, ...args: any) {\n      return fnRef.current!.apply(this, args);\n    }\n\n    memoFnRef.current = wrapper ? wrapper(memoFn as T) : (memoFn as T);\n  }\n\n  return memoFnRef.current;\n}\n"],"names":["useRef","useMemo","useFn","fn","wrapper","deps","wrapFn","memoFn","args","fnRef","current","apply","memoFnRef"],"mappings":"AAAA,SAASA,MAAM,EAAEC,OAAO,QAAQ,OAAO,CAAC;AAGxC;;;;;;;CAOC,GACD,OAAO,SAASC,KAAK,CACnBC,EAAK,EACLC,OAAsB,EAEtB;QADAC,IAAI,GAAJA,+CAAkB,kBAAX,EAAE,AAAS;QAmBTC,MAAM,GAAf,SAASA,MAAM,GAAG;QAChB,SAASC,MAAM,GAA0B;YAAd,IAAA,IAAA,IAAY,GAAZ,SAAY,CAAZ,MAAY,EAAZ,AAAGC,IAAI,GAAP,UAAA,IAAY,CAAA,EAAZ,IAAY,GAAZ,CAAY,EAAZ,IAAY,GAAZ,IAAY,EAAZ,IAAY,EAAA,CAAZ;gBAAA,AAAGA,IAAI,CAAP,IAAY,IAAZ,SAAY,AAAZ,CAAA,IAAY,CAAA,CAAA;YAAD,CAAC;YACrC,OAAOC,KAAK,CAACC,OAAO,CAAEC,KAAK,CAAC,IAAI,EAAEH,IAAI,CAAC,CAAC;QAC1C,CAAC;QAEDI,SAAS,CAACF,OAAO,GAAGN,OAAO,GAAGA,OAAO,CAACG,MAAM,CAAM,GAAIA,MAAM,AAAM,CAAC;IACrE,CAAC;IAvBD,IAAME,KAAK,GAAGT,MAAM,EAAK,AAAC;IAC1B,IAAMY,SAAS,GAAGZ,MAAM,CAAI,IAAI,CAAE,AAAC;IAEnC,SAAS;IACTC,OAAO,CAAC,WAAM;QACZ,IAAI,CAACW,SAAS,CAACF,OAAO,EAAE,OAAO;QAC/BJ,MAAM,EAAE,CAAC;IACX,CAAC,EAAED,IAAI,CAAC,CAAC;IAET,UAAU;IACV,IAAI,CAACO,SAAS,CAACF,OAAO,EAAEJ,MAAM,EAAE,CAAC;IAEjC,oCAAoC,GACnCL,OAAO,CAAS,WAAM;QACrBQ,KAAK,CAACC,OAAO,GAAGP,EAAE,CAAC;IACrB,CAAC,CAAC,CAAC;IAUH,OAAOS,SAAS,CAACF,OAAO,CAAC;AAC3B,CAAC"}